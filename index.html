<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>日本語 真偽判定タスク管理</title>
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <div id="experimenter-shell">
      <header>
        <h1>日本語 真偽判定タスク管理</h1>
        <small>文データセットとタスクセットをブラウザ内で整理できます</small>
      </header>

      <div class="tabs">
        <button class="tab-button active" data-tab="run-tab">🧪 参加者タスク</button>
        <button class="tab-button" data-tab="taskset-tab">🗂️ タスクセット</button>
        <button class="tab-button" data-tab="dataset-tab">📚 文データセット</button>
        <button class="tab-button" data-tab="prefs-tab">⚙️ 操作設定</button>
      </div>

      <main>
        <section id="run-tab" class="card">
          <h2 class="section-title">実験者用：参加者タスクの準備</h2>
          <p>
            ここでは，事前に用意した <strong>タスクセット</strong> を選び，
            参加者に提示する文と制限時間をまとめて実行できます。「タスクを開始」を押すと
            実験者用 UI が隠れ，参加者向けの指示画面が表示されます。
          </p>
          <div class="grid-2">
            <div>
              <label for="participant-task-select">タスクセット</label>
              <select id="participant-task-select"></select>
              <div class="inline-actions" style="margin-top: 0.5rem;">
                <button id="open-taskset-tab" class="btn btn-text" type="button">
                  タスクセットを編集する
                </button>
              </div>
            </div>
            <div>
              <label for="display-mode-select">表示モード</label>
              <select id="display-mode-select">
                <option value="pc">PC 用 UI</option>
                <option value="tablet">タブレット用 UI</option>
              </select>
              <p class="small-muted">
                タブレットモードではボタンや文字を大きくし，F/J キーなどの案内を非表示にします。
              </p>
            </div>
          </div>
          <div id="participant-task-summary" class="summary-box small-muted">
            タスクセットがまだ存在しません。「タスクセット」タブで作成してください。
          </div>
          <div class="keys-row">
            <div class="key-pill" id="true-key-pill">本当だと思う：F キー</div>
            <div class="key-pill" id="false-key-pill">うそだと思う：J キー</div>
          </div>
          <p class="subtext" id="task-key-hints">
            キーボードが使いづらい場合は，画面下部のボタンでも回答できます。
          </p>
          <div class="center" style="text-align: center; margin-top: 1rem;">
            <button id="participant-start" class="btn btn-primary">タスクを開始</button>
            <p class="small-muted" style="margin-top: 0.5rem;">
              ボタンを押すと参加者向けの注意事項画面に切り替わります。
            </p>
          </div>
          <div id="result-card" class="summary-box mt-3 hidden">
            <h3 class="section-title" style="margin-top: 0;">直近の結果ログ</h3>
            <p class="small-muted" style="margin-bottom: 0.4rem;">
              参加者の画面には表示されません。必要に応じてコピーしてください。
            </p>
            <textarea id="result-json" readonly spellcheck="false"></textarea>
          </div>
        </section>

      <section id="taskset-tab" class="card hidden">
        <h2 class="section-title">タスクセット管理</h2>
        <p class="small-muted">
          タスクセットには「参照する文データセット」「出題数」「制限時間」などの設定をまとめて登録します。
          参加者タスクではここに登録されたセットを選択して実行します。
        </p>
        <div class="grid-2">
          <div>
            <label for="taskset-selector">タスクセット一覧</label>
            <select id="taskset-selector"></select>
          </div>
          <div class="inline-actions">
            <button class="btn btn-outline" id="taskset-new" type="button">新規作成</button>
            <button class="btn btn-outline" id="taskset-duplicate" type="button">複製</button>
            <button class="btn btn-outline" id="taskset-delete" type="button">削除</button>
          </div>
        </div>

      <div class="flex-row mt-3">
        <div class="flex-1">
            <label for="taskset-name">タスクセット名</label>
            <input type="text" id="taskset-name" placeholder="例：120秒ウォームアップ" />

            <label for="taskset-sentence-set" class="mt-2">参照する文データセット</label>
            <select id="taskset-sentence-set"></select>
            <p class="small-muted" id="taskset-dataset-info"></p>

            <label for="taskset-question-count" class="mt-2">問題数（空欄なら全文）</label>
            <input type="number" id="taskset-question-count" min="1" placeholder="例：20" />

            <label style="font-weight: 400; display: flex; align-items: center; gap: 0.4rem; margin-top: 0.8rem;">
              <input type="checkbox" id="taskset-show-question-count" />
              残り問題数を画面に表示する
            </label>

            <label class="mt-2">提示順</label>
            <div>
              <label style="font-weight: 400;">
                <input type="checkbox" id="taskset-randomize" checked />
                出題ごとにランダムに並び替える（推奨）
              </label>
            </div>
          </div>
          <div class="flex-1">
            <label class="mt-2">制限時間</label>
            <div>
              <label style="font-weight: 400; display: flex; align-items: center; gap: 0.4rem;">
                <input type="checkbox" id="taskset-enable-timer" checked />
                制限時間を設定する
              </label>
            </div>
            <label for="taskset-duration" class="mt-1">制限時間（秒）</label>
            <input type="number" id="taskset-duration" min="10" step="10" value="120" />

            <label style="font-weight: 400; display: flex; align-items: center; gap: 0.4rem; margin-top: 0.8rem;">
              <input type="checkbox" id="taskset-show-timer" checked />
              制限時間を画面に表示する
            </label>

            <label for="taskset-notes" class="mt-2">メモ（参加者には表示されません）</label>
            <textarea id="taskset-notes" placeholder="目的や注意事項などのメモ"></textarea>
          </div>
        </div>

      <div class="mt-3" style="text-align: right;">
        <button class="btn btn-primary" id="taskset-save" type="button">設定を保存</button>
      </div>

      <div class="mt-4 summary-box">
        <h3 class="section-title" style="margin-top: 0;">タスクセット JSON 操作</h3>
        <p class="small-muted">
          ここではタスクセット全体を JSON でエクスポート／インポートできます。<br />
          編集後に <code>data/taskSets.json</code> を更新したい場合は、ダウンロードした JSON で手動で置き換えてください。
        </p>
        <textarea id="taskset-json" spellcheck="false" class="mb-2"></textarea>
        <div class="inline-actions" style="justify-content: flex-end;">
          <button class="btn btn-outline" id="taskset-json-apply" type="button">JSON を反映</button>
          <button class="btn btn-outline" id="taskset-json-download" type="button">JSON をダウンロード</button>
          <button class="btn btn-outline" id="taskset-reload" type="button">ファイルから再読み込み</button>
        </div>
      </div>
    </section>

      <section id="dataset-tab" class="card hidden">
        <h2 class="section-title">文データセット管理</h2>
        <p class="small-muted">
          文データセットごとに文をまとめて保存できます。初期値は <code>data/sentenceSets.json</code> に置いてあり，
          編集結果はブラウザに保存されます。必要なら JSON をダウンロードしてファイルを更新してください。
        </p>
        <div class="inline-actions" style="justify-content: flex-end;">
          <button class="btn btn-outline" id="dataset-reload" type="button">
            JSON ファイルから再読み込み
          </button>
        </div>
        <div class="grid-2">
          <div>
            <label for="dataset-selector">文データセット</label>
            <select id="dataset-selector"></select>
          </div>
          <div class="inline-actions">
            <button class="btn btn-outline" id="dataset-new" type="button">新規作成</button>
            <button class="btn btn-outline" id="dataset-duplicate" type="button">複製</button>
            <button class="btn btn-outline" id="dataset-delete" type="button">削除</button>
          </div>
        </div>

        <div class="flex-row mt-3">
          <div class="flex-1">
            <label for="dataset-name">セット名</label>
            <input type="text" id="dataset-name" placeholder="例：日常文セット" />

            <label for="dataset-description" class="mt-2">説明</label>
            <textarea id="dataset-description" placeholder="利用目的や特徴など"></textarea>

            <p class="small-muted" id="dataset-meta-info"></p>

            <div class="mt-2" style="text-align: right;">
              <button class="btn btn-primary" id="dataset-save" type="button">セット情報を保存</button>
            </div>
          </div>
          <div class="flex-1">
            <label for="dataset-json">JSON（このセットの sentences）</label>
            <textarea id="dataset-json" spellcheck="false" class="mb-2"></textarea>
            <div class="inline-actions" style="justify-content: flex-end;">
              <button class="btn btn-outline" id="dataset-json-apply" type="button">JSON から文を上書き</button>
              <button class="btn btn-outline" id="dataset-json-download" type="button">JSON をダウンロード</button>
            </div>
            <p class="small-muted mt-1">
              編集内容はブラウザの localStorage にのみ保存されます。必要に応じて JSON をコピーするか，ダウンロードして <code>data/sentenceSets.json</code> を更新してください。
            </p>
          </div>
        </div>

        <hr style="margin: 2rem 0; border: none; border-top: 1px solid #e5e7eb;" />

        <div class="flex-row">
          <div class="flex-1">
            <label for="new-sentence-text">文</label>
            <textarea id="new-sentence-text" placeholder="例：犬は四本足で歩く。"></textarea>

            <label for="new-sentence-truth" class="mt-2">真偽</label>
            <select id="new-sentence-truth">
              <option value="true">真（本当）</option>
              <option value="false">偽（うそ）</option>
            </select>

            <label for="new-sentence-tags" class="mt-2">タグ（カンマ区切り，任意）</label>
            <input type="text" id="new-sentence-tags" placeholder="例：動物,日常" />

            <div class="mt-2 inline-actions" style="justify-content: flex-start;">
              <button class="btn btn-primary" id="add-sentence" type="button">文を追加</button>
              <button class="btn btn-outline hidden" id="update-sentence" type="button">文を更新</button>
              <button class="btn btn-text hidden" id="cancel-edit-sentence" type="button">編集をキャンセル</button>
            </div>
            <p class="small-muted" id="sentence-edit-hint"></p>
          </div>
          <div class="flex-1">
            <h3 class="section-title" style="margin-top: 0;">文一覧</h3>
            <table>
              <thead>
                <tr>
                  <th style="width: 2rem;">#</th>
                  <th>文</th>
                  <th style="width: 4rem;">真偽</th>
                  <th style="width: 6rem;">タグ</th>
                  <th style="width: 3.5rem;"></th>
                </tr>
              </thead>
              <tbody id="sentence-table-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="prefs-tab" class="card hidden">
        <h2 class="section-title">操作設定</h2>
        <p class="small-muted">
          参加者が使うキー配置や，デバッグログの表示方法を設定します。設定はブラウザに保存され，すべてのタスクセットで共有されます。
        </p>
        <div class="flex-row">
          <div class="flex-1">
            <label for="pref-true-key">「本当」キー</label>
            <input type="text" id="pref-true-key" maxlength="1" placeholder="例：f" />

            <label for="pref-false-key" class="mt-2">「うそ」キー</label>
            <input type="text" id="pref-false-key" maxlength="1" placeholder="例：j" />
          </div>
          <div class="flex-1">
            <label class="mt-2">デバッグログ</label>
            <div>
              <label style="font-weight: 400;">
                <input type="checkbox" id="pref-debug" />
                ブラウザのコンソールに詳細ログを出力する
              </label>
            </div>
            <p class="small-muted mt-1">
              実験者が挙動を確認したいときのみ有効にしてください。
            </p>
          </div>
        </div>
        <div class="mt-3" style="text-align: right;">
          <button class="btn btn-primary" id="pref-save" type="button">設定を保存</button>
        </div>
      </section>
      </main>
    </div>

    <div id="participant-shell" class="participant-shell hidden">
      <div class="participant-frame">
        <div id="participant-setup" class="participant-panel">
          <h2 class="participant-title">真偽判定タスク</h2>
          <p class="participant-lead">以下の注意事項を読んでからスタートしてください。</p>
          <ul class="participant-guidelines">
            <li>表示される文章が正しい／正しくないを判断してください。</li>
            <li>正しいと思ったら，左の「本当だと思う」を押してください。</li>
            <li>正しくないと思ったら，左の「うそだと思う」を押してください。</li>
            <li>迷ったら，より自信のある方を選んでください。</li>
            <li>これは休憩タスクであり，評価はしません。ゆっくり答えて大丈夫です。</li>
            <li>2分間で，自動的に終了します。</li>
          </ul>
          <div class="participant-actions">
            <button id="participant-ready" class="btn btn-primary participant-start-btn">スタート</button>
          </div>
        </div>

        <div id="participant-running" class="participant-panel hidden">
          <div class="participant-sentence" id="sentence-text"></div>
          <div class="participant-actions">
            <button id="btn-true" class="btn btn-outline participant-response-btn">本当だと思う</button>
            <button id="btn-false" class="btn btn-outline participant-response-btn">うそだと思う</button>
          </div>
        </div>

        <div id="participant-finished" class="participant-panel hidden">
          <h2 class="participant-title">終了しました</h2>
          <p class="participant-finish-message">実験者に返却してください。</p>
        </div>
      </div>
    </div>

    <script type="module" src="assets/js/main.js"></script>
  </body>
</html>
